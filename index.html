<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ALTHEA NEXUS | V27.5 DEVICE</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <style>
        :root { --neon: #0f0; --bg: #000; --ui: #0ff; }
        body { background: #000; color: var(--neon); font-family: monospace; margin: 0; padding: 10px; display: flex; flex-direction: column; height: 100vh; overflow: hidden; box-sizing: border-box; }
        .terminal { background: #050505; border: 1px solid #333; height: 60px; overflow-y: auto; padding: 5px; font-size: 10px; margin-bottom: 5px; border-left: 2px solid var(--neon); }
        .main-view { display: flex; gap: 8px; flex-grow: 1; min-height: 0; }
        #sidebar { width: 120px; border: 1px solid #222; background: #050505; overflow-y: auto; padding: 5px; display: flex; flex-direction: column; gap: 4px; }
        .file-link { font-size: 9px; color: var(--ui); cursor: pointer; border-bottom: 1px solid #111; padding: 4px; overflow: hidden; text-overflow: ellipsis; }
        .file-link:hover { background: #111; }
        .portal-grid { display: flex; flex-direction: column; gap: 8px; flex-grow: 1; }
        @media (min-width: 768px) { .portal-grid { flex-direction: row; } }
        .panel { display: flex; flex-direction: column; border: 1px solid #222; background: #0a0a0a; flex: 1; overflow: hidden; position: relative; }
        .panel.fullscreen { position: fixed !important; inset: 0 !important; z-index: 10000; }
        .hdr { padding: 4px; font-size: 9px; background: #111; border-bottom: 1px solid #222; display: flex; justify-content: space-between; }
        textarea { flex-grow: 1; background: transparent; color: var(--neon); border: none; padding: 8px; font-size: 11px; outline: none; resize: none; }
        iframe { flex-grow: 1; background: #fff; border: none; }
        .controls { display: grid; grid-template-columns: repeat(5, 1fr); gap: 4px; margin-top: 8px; }
        .btn { background: #111; color: var(--neon); border: 1px solid var(--neon); padding: 8px 0; cursor: pointer; font-size: 8px; text-align: center; }
        #mnt { background: #111; color: var(--ui); border: 1px dashed var(--ui); text-align: center; padding: 10px; cursor: pointer; font-size: 10px; margin-bottom: 5px; }
    </style>
</head>
<body>
    <div class="terminal" id="term"><div>[V27.5] Physical Virtual Device Online.</div></div>
    <label id="mnt">[+] MOUNT PROJECT FOLDER <input type="file" webkitdirectory directory multiple style="display:none" onchange="ingest(this.files)"></label>
    <div class="main-view">
        <div id="sidebar"><div style="font-size:8px; color:#555; margin-bottom:5px;">[MANIFEST]</div></div>
        <div class="portal-grid">
            <div class="panel" id="p1"><div class="hdr"><span>EDIT: <span id="fn" style="color:#555">---</span></span><button onclick="tg('p1')">MAX</button></div><textarea id="ed" spellcheck="false"></textarea></div>
            <div class="panel" id="p2"><div class="hdr"><span>PORTAL</span><button onclick="tg('p2')">MAX</button></div><iframe id="ifr"></iframe></div>
        </div>
    </div>
    <div class="controls">
        <div class="btn" onclick="apply()">RELOAD</div>
        <div class="btn" onclick="save()">SAVE</div>
        <div class="btn" onclick="document.getElementById('zipIn').click()">ZIP</div>
        <div class="btn" onclick="exp()">EXPORT</div>
        <div class="btn" onclick="location.reload()" style="color:red">PURGE</div>
    </div>
    <input type="file" id="zipIn" accept=".zip" style="display:none" onchange="ingestZip(this)">
    <script>
        const log = (m, c="#0f0") => { const d = document.getElementById('term'); d.innerHTML += `<div>> <span style="color:${c}">${m}</span></div>`; d.scrollTop = d.scrollHeight; };
        const tg = i => document.getElementById(i).classList.toggle('fullscreen');
        let drive = {};

        async function ingest(fs) {
            for (let f of fs) { 
                const t = await f.text(); drive[f.name] = t; 
                if(f.name.match(/althea|index/i)) load(f.name, t);
            }
            updateManifest(); log(`Mounted ${Object.keys(drive).length} assets.`);
        }

        async function ingestZip(input) {
            const z = await JSZip.loadAsync(input.files[0]);
            for (let [n, e] of Object.entries(z.files)) {
                if (!e.dir) { const t = await e.async("text"); drive[n] = t; if(n.match(/althea|index/i)) load(n, t); }
            }
            updateManifest(); log("Archive Mounted.");
        }

        function updateManifest() {
            const s = document.getElementById('sidebar');
            s.innerHTML = '<div style="font-size:8px; color:#555; margin-bottom:5px;">[MANIFEST]</div>';
            Object.keys(drive).forEach(k => {
                const d = document.createElement('div'); d.className = 'file-link'; d.innerText = k;
                d.onclick = () => load(k, drive[k]); s.appendChild(d);
            });
        }

        function load(n, t) { document.getElementById('fn').innerText = n; document.getElementById('ed').value = t; apply(); }
        function apply() {
            const b = new Blob([document.getElementById('ed').value], { type: 'text/html' });
            document.getElementById('ifr').src = URL.createObjectURL(b); log("Hot Reload Successful.");
        }
        function save() {
            const a = document.createElement("a"); a.href = URL.createObjectURL(new Blob([document.getElementById('ed').value]));
            a.download = document.getElementById('fn').innerText || "file.html"; a.click();
        }
        function exp() {
            const a = document.createElement("a"); a.href = URL.createObjectURL(new Blob([JSON.stringify(drive)]));
            a.download = "DEVICE_SNAP.txt"; a.click();
        }
    </script>
</body>
</html>
